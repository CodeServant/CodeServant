<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Przesyłanie danych między wątkami za pomocą przekazywania wiadomości - Język programowania Rust</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="ferris-d33b75bf.css">
        <link rel="stylesheet" href="theme/2018-edition-4e126c62.css">
        <link rel="stylesheet" href="theme/semantic-notes-9b5766c0.css">
        <link rel="stylesheet" href="theme/listing-cab26221.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-773dca2f.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-039e37ba.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">Język programowania Rust</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/rust-lang/book" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <!-- Old headings. Do not remove or links may break. -->
<p><a id="using-message-passing-to-transfer-data-between-threads"></a></p>
<h2 id="przesyłanie-danych-między-wątkami-za-pomocą-przekazywania-wiadomości"><a class="header" href="#przesyłanie-danych-między-wątkami-za-pomocą-przekazywania-wiadomości">Przesyłanie danych między wątkami za pomocą przekazywania wiadomości</a></h2>
<p>Jednym z coraz popularniejszych podejść do zapewnienia bezpiecznej
współbieżności jest przekazywanie wiadomości, gdzie wątki lub aktorzy
komunikują się, wysyłając sobie wiadomości zawierające dane. Oto idea w haśle z
<a href="https://golang.org/doc/effective_go.html#concurrency">dokumentacji języka Go</a>:
„Nie komunikuj się poprzez współdzielenie pamięci; zamiast tego współdziel
pamięć poprzez komunikację.”</p>
<p>Aby zrealizować współbieżność opartą na przekazywaniu wiadomości, biblioteka
standardowa Rust dostarcza implementację kanałów. <em>Kanał</em> to ogólna koncepcja
programistyczna, za pomocą której dane są przesyłane z jednego wątku do
drugiego.</p>
<p>Możesz wyobrazić sobie kanał w programowaniu jako kierunkowy kanał wodny, taki
jak strumień lub rzeka. Jeśli wrzucisz coś, na przykład gumową kaczkę, do rzeki,
będzie ona płynęła w dół rzeki aż do końca szlaku wodnego.</p>
<p>Kanał ma dwie połówki: nadajnik i odbiornik. Połówka nadajnika to miejsce
w górze rzeki, gdzie wrzucasz gumową kaczkę, a połówka odbiornika to miejsce,
gdzie gumowa kaczka dociera w dół rzeki. Jedna część twojego kodu wywołuje
metody na nadajniku z danymi, które chcesz wysłać, a inna część sprawdza koniec
odbiorczy pod kątem nadchodzących wiadomości. Kanał jest uważany za <em>zamknięty</em>,
jeśli którakolwiek z połówek – nadajnik lub odbiornik – zostanie usunięta.</p>
<p>Tutaj stworzymy program, który będzie miał jeden wątek do generowania wartości
i wysyłania ich przez kanał, oraz inny wątek, który będzie odbierał te wartości
i wypisywał je. Będziemy przesyłać proste wartości między wątkami za pomocą
kanału, aby zilustrować tę funkcję. Gdy już zapoznasz się z tą techniką,
będziesz mógł używać kanałów dla dowolnych wątków, które muszą się ze sobą
komunikować, np. w systemie czatu lub w systemie, gdzie wiele wątków wykonuje
części obliczeń i wysyła je do jednego wątku, który agreguje wyniki.</p>
<p>Najpierw, w Listingu 16-6, stworzymy kanał, ale nic z nim nie zrobimy. Zauważ,
że to jeszcze się nie skompiluje, ponieważ Rust nie potrafi określić, jakiego
typu wartości chcemy przesyłać przez kanał.</p>
<listing number="16-6" file-name="src/main.rs" caption="Tworzenie kanału i przypisywanie dwóch połówek do `tx` i `rx`">
<pre><code class="language-rust ignore does_not_compile">use std::sync::mpsc;

fn main() {
    let (tx, rx) = mpsc::channel();
}</code></pre>
</listing>
<p>Tworzymy nowy kanał za pomocą funkcji <code>mpsc::channel</code>; <code>mpsc</code> oznacza
<em>multiple producer, single consumer</em> (wielu producentów, jeden konsument). W
skrócie, sposób, w jaki biblioteka standardowa Rust implementuje kanały,
oznacza, że kanał może mieć wiele końców <em>wysyłających</em>, które produkują
wartości, ale tylko jeden koniec <em>odbierający</em>, który te wartości konsumuje.
Wyobraź sobie wiele strumieni spływających do jednej dużej rzeki: Wszystko,
co zostanie wysłane w dół któregokolwiek ze strumieni, znajdzie się w jednej
rzece na końcu. Na razie zaczniemy od jednego producenta, ale dodamy wielu
producentów, gdy ten przykład zadziała.</p>
<p>Funkcja <code>mpsc::channel</code> zwraca krotkę, której pierwszy element to koniec
wysyłający – nadajnik – a drugi element to koniec odbierający – odbiornik.
Skróty <code>tx</code> i <code>rx</code> są tradycyjnie używane w wielu dziedzinach odpowiednio dla
<em>transmitter</em> (nadajnik) i <em>receiver</em> (odbiornik), więc tak nazywamy nasze
zmienne, aby wskazać każdy koniec. Używamy instrukcji <code>let</code> ze wzorcem,
który dekomponuje krotki; o użyciu wzorców w instrukcjach <code>let</code> i
dekompozycji będziemy rozmawiać w Rozdziale 19. Na razie wiedz, że użycie
instrukcji <code>let</code> w ten sposób jest wygodnym podejściem do wyodrębniania
elementów krotki zwracanej przez <code>mpsc::channel</code>.</p>
<p>Przenieśmy koniec nadawczy do utworzonego wątku i niech wyśle jeden ciąg
znaków, tak aby utworzony wątek komunikował się z głównym wątkiem, jak
pokazano w Listingu 16-7. To jest jak wrzucenie gumowej kaczki do rzeki w
górnym biegu lub wysłanie wiadomości na czacie z jednego wątku do drugiego.</p>
<listing number="16-7" file-name="src/main.rs" caption="Przenoszenie `tx` do utworzonego wątku i wysyłanie `&quot;hi&quot;`">
<pre class="playground"><code class="language-rust edition2024">use std::sync::mpsc;
use std::thread;

fn main() {
    let (tx, rx) = mpsc::channel();

    thread::spawn(move || {
        let val = String::from("hi");
        tx.send(val).unwrap();
    });
}</code></pre>
</listing>
<p>Ponownie używamy <code>thread::spawn</code> do utworzenia nowego wątku, a następnie
używamy <code>move</code> do przeniesienia <code>tx</code> do domknięcia, tak aby utworzony wątek
był właścicielem <code>tx</code>. Utworzony wątek musi być właścicielem nadajnika, aby
móc wysyłać wiadomości przez kanał.</p>
<p>Nadajnik ma metodę <code>send</code>, która przyjmuje wartość, którą chcemy wysłać.
Metoda <code>send</code> zwraca typ <code>Result&lt;T, E&gt;</code>, więc jeśli odbiornik został już
usunięty i nie ma dokąd wysłać wartości, operacja wysyłania zwróci błąd.
W tym przykładzie wywołujemy <code>unwrap</code>, aby spowodować panikę w przypadku błędu.
Ale w prawdziwej aplikacji obsłużylibyśmy to poprawnie: Wróć do Rozdziału 9,
aby przejrzeć strategie właściwej obsługi błędów.</p>
<p>W Listingu 16-8 pobierzemy wartość z odbiornika w głównym wątku. To jest jak
pobieranie gumowej kaczki z wody na końcu rzeki lub odbieranie wiadomości na
czacie.</p>
<listing number="16-8" file-name="src/main.rs" caption="Odbieranie wartości `&quot;hi&quot;` w głównym wątku i jej wypisywanie">
<pre class="playground"><code class="language-rust edition2024">use std::sync::mpsc;
use std::thread;

fn main() {
    let (tx, rx) = mpsc::channel();

    thread::spawn(move || {
        let val = String::from("hi");
        tx.send(val).unwrap();
    });

    let received = rx.recv().unwrap();
    println!("Got: {received}");
}</code></pre>
</listing>
<p>Odbiornik ma dwie przydatne metody: <code>recv</code> i <code>try_recv</code>. Używamy <code>recv</code>,
skrótu od <em>receive</em> (odbierz), która zablokuje wykonanie głównego wątku i
poczeka, aż wartość zostanie wysłana przez kanał. Gdy tylko wartość zostanie
wysłana, <code>recv</code> zwróci ją w <code>Result&lt;T, E&gt;</code>. Gdy nadajnik zostanie zamknięty,
<code>recv</code> zwróci błąd, sygnalizując, że nie nadejdą już więcej wartości.</p>
<p>Metoda <code>try_recv</code> nie blokuje, ale zamiast tego natychmiast zwraca <code>Result&lt;T, E&gt;</code>: wartość <code>Ok</code> zawierającą wiadomość, jeśli jest dostępna, oraz wartość
<code>Err</code>, jeśli tym razem nie ma żadnych wiadomości. Użycie <code>try_recv</code> jest
przydatne, jeśli ten wątek ma inną pracę do wykonania podczas oczekiwania na
wiadomości: Moglibyśmy napisać pętlę, która co jakiś czas wywołuje <code>try_recv</code>,
obchodzi wiadomość, jeśli jest dostępna, a w przeciwnym razie wykonuje inną
pracę przez jakiś czas, zanim ponownie sprawdzi.</p>
<p>W tym przykładzie dla uproszczenia użyliśmy <code>recv</code>; główny wątek nie ma innej
pracy do wykonania poza czekaniem na wiadomości, więc blokowanie głównego
wątku jest odpowiednie.</p>
<p>Po uruchomieniu kodu z Listingu 16-8 zobaczymy wartość wypisaną z głównego
wątku:</p>
<!-- Not extracting output because changes to this output aren't significant;
the changes are likely to be due to the threads running differently rather than
changes in the compiler -->
<pre><code class="language-text">Got: hi
</code></pre>
<p>Idealnie!</p>
<!-- Old headings. Do not remove or links may break. -->
<p><a id="channels-and-ownership-transference"></a></p>
<h3 id="przenoszenie-własności-przez-kanały"><a class="header" href="#przenoszenie-własności-przez-kanały">Przenoszenie własności przez kanały</a></h3>
<p>Zasady własności odgrywają kluczową rolę w przesyłaniu wiadomości, ponieważ
pomagają pisać bezpieczny, współbieżny kod. Zapobieganie błędom w programowaniu
współbieżnym to zaleta myślenia o własności w całym programie Rust. Przeprowadźmy
eksperyment, aby pokazać, jak kanały i własność współpracują, aby zapobiegać
problemom: Spróbujemy użyć wartości <code>val</code> w utworzonym wątku <em>po</em> tym, jak
wysłaliśmy ją przez kanał. Spróbuj skompilować kod z Listingu 16-9, aby
zobaczyć, dlaczego ten kod jest niedozwolony.</p>
<listing number="16-9" file-name="src/main.rs" caption="Próba użycia `val` po wysłaniu go przez kanał">
<pre><code class="language-rust ignore does_not_compile">use std::sync::mpsc;
use std::thread;

fn main() {
    let (tx, rx) = mpsc::channel();

    thread::spawn(move || {
        let val = String::from("hi");
        tx.send(val).unwrap();
        println!("val is {val}");
    });

    let received = rx.recv().unwrap();
    println!("Got: {received}");
}</code></pre>
</listing>
<p>Tutaj próbujemy wypisać <code>val</code> po tym, jak wysłaliśmy go przez kanał za pomocą
<code>tx.send</code>. Zezwolenie na to byłoby złym pomysłem: Gdy wartość zostanie
wysłana do innego wątku, ten wątek mógłby ją zmodyfikować lub usunąć, zanim
ponownie spróbujemy jej użyć. Potencjalnie modyfikacje innego wątku mogłyby
spowodować błędy lub nieoczekiwane rezultaty z powodu niespójnych lub
nieistniejących danych. Jednak Rust zgłasza błąd, jeśli spróbujemy
skompilować kod z Listingu 16-9:</p>
<pre><code class="language-console">$ cargo run
   Compiling message-passing v0.1.0 (file:///projects/message-passing)
error[E0382]: borrow of moved value: `val`
  --&gt; src/main.rs:10:27
   |
 8 |         let val = String::from("hi");
   |             --- move occurs because `val` has type `String`, which does not implement the `Copy` trait
 9 |         tx.send(val).unwrap();
   |                 --- value moved here
10 |         println!("val is {val}");
   |                           ^^^ value borrowed here after move
   |
   = note: this error originates in the macro `$crate::format_args_nl` which comes from the expansion of the macro `println` (in Nightly builds, run with -Z macro-backtrace for more info)

For more information about this error, try `rustc --explain E0382`.
error: could not compile `message-passing` (bin "message-passing") due to 1 previous error
</code></pre>
<p>Nasz błąd współbieżności spowodował błąd kompilacji. Funkcja <code>send</code> przejmuje
własność swojego parametru, a po przeniesieniu wartości odbiornik przejmuje jej
własność. To uniemożliwia nam przypadkowe ponowne użycie wartości po jej
wysłaniu; system własności sprawdza, czy wszystko jest w porządku.</p>
<!-- Old headings. Do not remove or links may break. -->
<p><a id="sending-multiple-values-and-seeing-the-receiver-waiting"></a></p>
<h3 id="wysyłanie-wielu-wartości"><a class="header" href="#wysyłanie-wielu-wartości">Wysyłanie wielu wartości</a></h3>
<p>Kod z Listingu 16-8 skompilował się i zadziałał, ale nie pokazał nam jasno, że
dwa oddzielne wątki komunikowały się ze sobą przez kanał.</p>
<p>W Listingu 16-10 wprowadziliśmy pewne modyfikacje, które udowodnią, że kod z
Listingu 16-8 działa współbieżnie: utworzony wątek będzie teraz wysyłał wiele
wiadomości i pauzował na sekundę między każdą wiadomością.</p>
<listing number="16-10" file-name="src/main.rs" caption="Wysyłanie wielu wiadomości i pauzowanie między każdą z nich">
<pre><code class="language-rust noplayground">use std::sync::mpsc;
use std::thread;
use std::time::Duration;

fn main() {
    let (tx, rx) = mpsc::channel();

    thread::spawn(move || {
        let vals = vec![
            String::from("hi"),
            String::from("from"),
            String::from("the"),
            String::from("thread"),
        ];

        for val in vals {
            tx.send(val).unwrap();
            thread::sleep(Duration::from_secs(1));
        }
    });

    for received in rx {
        println!("Got: {received}");
    }
}</code></pre>
</listing>
<p>Tym razem utworzony wątek ma wektor ciągów, które chcemy wysłać do głównego
wątku. Iterujemy po nich, wysyłając każdy z osobna i pauzując między każdym,
wywołując funkcję <code>thread::sleep</code> z wartością <code>Duration</code> wynoszącą jedną sekundę.</p>
<p>W głównym wątku nie wywołujemy już jawnie funkcji <code>recv</code>: Zamiast tego
traktujemy <code>rx</code> jako iterator. Dla każdej otrzymanej wartości wypisujemy ją.
Gdy kanał zostanie zamknięty, iteracja się zakończy.</p>
<p>Podczas uruchamiania kodu z Listingu 16-10 powinieneś zobaczyć następujący
wynik z jednominutową przerwą między każdą linią:</p>
<!-- Not extracting output because changes to this output aren't significant;
the changes are likely to be due to the threads running differently rather than
changes in the compiler -->
<pre><code class="language-text">Got: hi
Got: from
Got: the
Got: thread
</code></pre>
<p>Ponieważ nie mamy żadnego kodu, który pauzuje lub opóźnia w pętli <code>for</code> w
głównym wątku, możemy stwierdzić, że główny wątek czeka na odebranie wartości
z utworzonego wątku.</p>
<!-- Old headings. Do not remove or links may break. -->
<p><a id="creating-multiple-producers-by-cloning-the-transmitter"></a></p>
<h3 id="tworzenie-wielu-producentów"><a class="header" href="#tworzenie-wielu-producentów">Tworzenie wielu producentów</a></h3>
<p>Wcześniej wspomnieliśmy, że <code>mpsc</code> to skrót od <em>multiple producer, single
consumer</em> (wiele producentów, jeden konsument). Wykorzystajmy <code>mpsc</code> i
rozszerzmy kod z Listingu 16-10, aby utworzyć wiele wątków, które wszystkie
wysyłają wartości do tego samego odbiornika. Możemy to zrobić, klonując
nadajnik, jak pokazano w Listingu 16-11.</p>
<listing number="16-11" file-name="src/main.rs" caption="Wysyłanie wielu wiadomości od wielu producentów">
<pre><code class="language-rust noplayground"><span class="boring">use std::sync::mpsc;
</span><span class="boring">use std::thread;
</span><span class="boring">use std::time::Duration;
</span><span class="boring">
</span><span class="boring">fn main() {
</span>    // --snip--

    let (tx, rx) = mpsc::channel();

    let tx1 = tx.clone();
    thread::spawn(move || {
        let vals = vec![
            String::from("hi"),
            String::from("from"),
            String::from("the"),
            String::from("thread"),
        ];

        for val in vals {
            tx1.send(val).unwrap();
            thread::sleep(Duration::from_secs(1));
        }
    });

    thread::spawn(move || {
        let vals = vec![
            String::from("more"),
            String::from("messages"),
            String::from("for"),
            String::from("you"),
        ];

        for val in vals {
            tx.send(val).unwrap();
            thread::sleep(Duration::from_secs(1));
        }
    });

    for received in rx {
        println!("Got: {received}");
    }

    // --snip--
<span class="boring">}</span></code></pre>
</listing>
<p>Tym razem, zanim utworzymy pierwszy wątek, wywołujemy <code>clone</code> na nadajniku.
Spowoduje to utworzenie nowego nadajnika, który możemy przekazać do pierwszego
utworzonego wątku. Oryginalny nadajnik przekazujemy do drugiego utworzonego
wątku. Daje nam to dwa wątki, każdy wysyłający różne wiadomości do jednego
odbiornika.</p>
<p>Po uruchomieniu kodu, wynik powinien wyglądać mniej więcej tak:</p>
<!-- Not extracting output because changes to this output aren't significant;
the changes are likely to be due to the threads running differently rather than
changes in the compiler -->
<pre><code class="language-text">Got: hi
Got: more
Got: from
Got: messages
Got: for
Got: the
Got: thread
Got: you
</code></pre>
<p>Możesz zobaczyć wartości w innej kolejności, w zależności od twojego systemu.
To właśnie sprawia, że współbieżność jest interesująca, a także trudna. Jeśli
poeksperymentujesz z <code>thread::sleep</code>, nadając mu różne wartości w różnych
wątkach, każde uruchomienie będzie bardziej niedeterministyczne i za każdym
razem będzie generować inne dane wyjściowe.</p>
<p>Teraz, gdy przyjrzeliśmy się, jak działają kanały, spójrzmy na inną metodę
współbieżności.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="ch16-01-threads.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="ch16-03-shared-state.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="ch16-01-threads.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="ch16-03-shared-state.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->
        <script src="ferris-2317480c.js"></script>



    </div>
    </body>
</html>
