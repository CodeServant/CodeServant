<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Refaktoryzacja w celu poprawy modułowości i obsługi błędów - Język programowania Rust</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="ferris-d33b75bf.css">
        <link rel="stylesheet" href="theme/2018-edition-4e126c62.css">
        <link rel="stylesheet" href="theme/semantic-notes-9b5766c0.css">
        <link rel="stylesheet" href="theme/listing-cab26221.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-773dca2f.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-039e37ba.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">Język programowania Rust</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/rust-lang/book" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h2 id="refaktoryzacja-w-celu-poprawy-modułowości-i-obsługi-błędów"><a class="header" href="#refaktoryzacja-w-celu-poprawy-modułowości-i-obsługi-błędów">Refaktoryzacja w celu poprawy modułowości i obsługi błędów</a></h2>
<p>Aby ulepszyć nasz program, naprawimy cztery problemy związane ze strukturą
programu i sposobem obsługi potencjalnych błędów. Po pierwsze, nasza funkcja
<code>main</code> wykonuje teraz dwa zadania: parsuje argumenty i odczytuje pliki. W
miarę rozwoju programu liczba oddzielnych zadań, które obsługuje funkcja
<code>main</code>, będzie rosła. Gdy funkcja zyskuje nowe obowiązki, staje się trudniejsza
do zrozumienia, trudniejsza do testowania i trudniejsza do zmiany bez
uszkodzenia jednej z jej części. Najlepiej jest oddzielić funkcjonalność,
tak aby każda funkcja była odpowiedzialna za jedno zadanie.</p>
<p>Ten problem wiąże się również z drugim problemem: chociaż <code>query</code> i
<code>file_path</code> są zmiennymi konfiguracyjnymi naszego programu, zmienne takie jak
<code>contents</code> są używane do wykonywania logiki programu. Im dłuższy staje się
<code>main</code>, tym więcej zmiennych będziemy musieli wprowadzić do zakresu; im więcej
zmiennych mamy w zakresie, tym trudniej będzie śledzić cel każdej z nich.
Najlepiej jest pogrupować zmienne konfiguracyjne w jedną strukturę, aby ich cel
był jasny.</p>
<p>Trzeci problem polega na tym, że użyliśmy <code>expect</code> do wyświetlenia
komunikatu o błędzie, gdy odczyt pliku nie powiódł się, ale komunikat o
błędzie po prostu wyświetla <code>Should have been able to read the file</code>. Odczyt
pliku może zakończyć się niepowodzeniem na wiele sposobów: na przykład plik
może brakować lub możemy nie mieć uprawnień do jego otwarcia. Obecnie,
niezależnie od sytuacji, wyświetlalibyśmy ten sam komunikat o błędzie dla
wszystkiego, co nie dostarczyłoby użytkownikowi żadnych informacji!</p>
<p>Po czwarte, używamy <code>expect</code> do obsługi błędu, a jeśli użytkownik uruchomi nasz
program bez podania wystarczającej liczby argumentów, otrzyma błąd <code>index out of bounds</code> z Rusta, który nie wyjaśnia jasno problemu. Byłoby najlepiej,
gdyby cały kod obsługi błędów znajdował się w jednym miejscu, tak aby przyszli
utrzymujący mieli tylko jedno miejsce do konsultowania kodu, jeśli logika
obsługi błędów wymagałaby zmiany. Posiadanie całego kodu obsługi błędów w
jednym miejscu zapewni również, że wyświetlamy komunikaty, które będą
zrozumiałe dla naszych użytkowników końcowych.</p>
<p>Rozwiążemy te cztery problemy, refaktoryzując nasz projekt.</p>
<!-- Old headings. Do not remove or links may break. -->
<p><a id="separation-of-concerns-for-binary-projects"></a></p>
<h3 id="rozdzielanie-odpowiedzialności-w-projektach-binarnych"><a class="header" href="#rozdzielanie-odpowiedzialności-w-projektach-binarnych">Rozdzielanie odpowiedzialności w projektach binarnych</a></h3>
<p>Problem organizacyjny polegający na przypisywaniu funkcji <code>main</code>
odpowiedzialności za wiele zadań jest powszechny w wielu projektach
binarnych. W rezultacie wielu programistów Rust uważa za przydatne
rozdzielenie różnych aspektów programu binarnego, gdy funkcja <code>main</code> staje
się zbyt duża. Proces ten obejmuje następujące kroki:</p>
<ul>
<li>Podziel program na pliki <em>main.rs</em> i <em>lib.rs</em> i przenieś logikę programu
do <em>lib.rs</em>.</li>
<li>Dopóki logika parsowania wiersza poleceń jest mała, może pozostać w
funkcji <code>main</code>.</li>
<li>Kiedy logika parsowania wiersza poleceń zaczyna się komplikować, wyodrębnij
ją z funkcji <code>main</code> do innych funkcji lub typów.</li>
</ul>
<p>Obowiązki, które pozostają w funkcji <code>main</code> po tym procesie, powinny być
ograniczone do następujących:</p>
<ul>
<li>Wywołanie logiki parsowania wiersza poleceń z wartościami argumentów</li>
<li>Ustawienie wszelkich innych konfiguracji</li>
<li>Wywołanie funkcji <code>run</code> w <em>lib.rs</em></li>
<li>Obsługa błędu, jeśli <code>run</code> zwróci błąd</li>
</ul>
<p>Ten wzorzec polega na rozdzieleniu odpowiedzialności: <em>main.rs</em> zajmuje się
uruchamianiem programu, a <em>lib.rs</em> obsługuje całą logikę bieżącego zadania.
Ponieważ nie można bezpośrednio testować funkcji <code>main</code>, ta struktura pozwala
testować całą logikę programu, przenosząc ją poza funkcję <code>main</code>. Kod,
który pozostaje w funkcji <code>main</code>, będzie wystarczająco mały, aby zweryfikować
jego poprawność poprzez odczytanie. Przeróbmy nasz program, postępując
zgodnie z tym procesem.</p>
<h4 id="wyodrębnianie-parsera-argumentów"><a class="header" href="#wyodrębnianie-parsera-argumentów">Wyodrębnianie parsera argumentów</a></h4>
<p>Wyodrębnimy funkcjonalność parsowania argumentów do funkcji, którą wywoła <code>main</code>.
Listing 12-5 pokazuje nowy początek funkcji <code>main</code>, która wywołuje nową funkcję
<code>parse_config</code>, którą zdefiniujemy w <em>src/main.rs</em>.</p>
<figure class="listing" id="listing-12-5">
<span class="file-name">Nazwa pliku: src/main.rs</span>
<pre><code class="language-rust ignore"><span class="boring">use std::env;
</span><span class="boring">use std::fs;
</span><span class="boring">
</span>fn main() {
    let args: Vec&lt;String&gt; = env::args().collect();

    let (query, file_path) = parse_config(&amp;args);

    // --snip--
<span class="boring">
</span><span class="boring">    println!("Searching for {query}");
</span><span class="boring">    println!("In file {file_path}");
</span><span class="boring">
</span><span class="boring">    let contents = fs::read_to_string(file_path)
</span><span class="boring">        .expect("Should have been able to read the file");
</span><span class="boring">
</span><span class="boring">    println!("With text:\n{contents}");
</span>}

fn parse_config(args: &amp;[String]) -&gt; (&amp;str, &amp;str) {
    let query = &amp;args[1];
    let file_path = &amp;args[2];

    (query, file_path)
}</code></pre>
<figcaption><a href="#listing-12-5">Listing 12-5</a>: Wyodrębnianie funkcji <code>parse_config</code> z <code>main</code></figcaption>
</figure>
<p>Nadal zbieramy argumenty wiersza poleceń do wektora, ale zamiast przypisywać
wartość argumentu pod indeksem 1 do zmiennej <code>query</code> i wartość argumentu pod
indeksem 2 do zmiennej <code>file_path</code> w funkcji <code>main</code>, przekazujemy cały wektor
do funkcji <code>parse_config</code>. Funkcja <code>parse_config</code> zawiera następnie logikę,
która określa, który argument trafia do której zmiennej i przekazuje wartości
z powrotem do <code>main</code>. Nadal tworzymy zmienne <code>query</code> i <code>file_path</code> w <code>main</code>,
ale <code>main</code> nie jest już odpowiedzialny za określanie, jak argumenty wiersza
poleceń i zmienne odpowiadają sobie.</p>
<p>Ta przeróbka może wydawać się przesadna dla naszego małego programu, ale
refaktoryzujemy ją małymi, przyrostowymi krokami. Po dokonaniu tej zmiany,
uruchom program ponownie, aby sprawdzić, czy parsowanie argumentów nadal
działa. Dobrze jest często sprawdzać postępy, aby pomóc zidentyfikować przyczynę
problemów, gdy się pojawią.</p>
<h4 id="grupowanie-wartości-konfiguracyjnych"><a class="header" href="#grupowanie-wartości-konfiguracyjnych">Grupowanie wartości konfiguracyjnych</a></h4>
<p>Możemy podjąć kolejny mały krok, aby jeszcze bardziej ulepszyć funkcję
<code>parse_config</code>. W tej chwili zwracamy krotkę, ale natychmiast rozbijamy tę
krotkę ponownie na pojedyncze części. Jest to znak, że być może nie mamy
jeszcze odpowiedniej abstrakcji.</p>
<p>Inny wskaźnik, który pokazuje, że jest miejsce na ulepszenia, to część <code>config</code>
w <code>parse_config</code>, co implikuje, że dwie zwracane wartości są powiązane i obie
są częścią jednej wartości konfiguracyjnej. Obecnie nie przekazujemy tego
znaczenia w strukturze danych inaczej niż poprzez grupowanie dwóch wartości w
krotkę; zamiast tego umieścimy dwie wartości w jednej strukturze i nadamy
każdemu z pól struktury znaczącą nazwę. Zrobienie tego ułatwi przyszłym
utrzymującym ten kod zrozumienie, jak różne wartości są ze sobą powiązane i
jaki jest ich cel.</p>
<p>Listing 12-6 pokazuje ulepszenia funkcji <code>parse_config</code>.</p>
<figure class="listing" id="listing-12-6">
<span class="file-name">Nazwa pliku: src/main.rs</span>
<pre><code class="language-rust should_panic noplayground"><span class="boring">use std::env;
</span><span class="boring">use std::fs;
</span><span class="boring">
</span>fn main() {
    let args: Vec&lt;String&gt; = env::args().collect();

    let config = parse_config(&amp;args);

    println!("Searching for {}", config.query);
    println!("In file {}", config.file_path);

    let contents = fs::read_to_string(config.file_path)
        .expect("Should have been able to read the file");

    // --snip--
<span class="boring">
</span><span class="boring">    println!("With text:\n{contents}");
</span>}

struct Config {
    query: String,
    file_path: String,
}

fn parse_config(args: &amp;[String]) -&gt; Config {
    let query = args[1].clone();
    let file_path = args[2].clone();

    Config { query, file_path }
}</code></pre>
<figcaption><a href="#listing-12-6">Listing 12-6</a>: Refaktoryzacja <code>parse_config</code> w celu zwrócenia instancji struktury <code>Config</code></figcaption>
</figure>
<p>Dodaliśmy strukturę o nazwie <code>Config</code> z polami <code>query</code> i <code>file_path</code>. Sygnatura
<code>parse_config</code> wskazuje teraz, że zwraca wartość <code>Config</code>. W ciele <code>parse_config</code>,
gdzie wcześniej zwracaliśmy wycinki stringów, które odwoływały się do wartości
<code>String</code> w <code>args</code>, teraz definiujemy <code>Config</code> tak, aby zawierał własne wartości
<code>String</code>. Zmienna <code>args</code> w <code>main</code> jest właścicielem wartości argumentów i tylko
pozwala funkcji <code>parse_config</code> je pożyczyć, co oznacza, że naruszylibyśmy zasady
pożyczania Rusta, gdyby <code>Config</code> próbowało przejąć własność wartości w <code>args</code>.</p>
<p>Istnieje wiele sposobów zarządzania danymi <code>String</code>; najłatwiejsza, choć
nieco nieefektywna, droga to wywołanie metody <code>clone</code> na wartościach. Spowoduje
to pełną kopię danych dla instancji <code>Config</code>, co zajmuje więcej czasu i pamięci
niż przechowywanie referencji do danych ciągu znaków. Jednak klonowanie danych
również sprawia, że nasz kod jest bardzo prosty, ponieważ nie musimy
zarządzać czasami życia referencji; w tych okolicznościach, rezygnacja z
nieco wydajności na rzecz prostoty jest opłacalnym kompromisem.</p>
<section class="note" aria-role="note">
<h3 id="kompromisy-związane-z-używaniem-clone"><a class="header" href="#kompromisy-związane-z-używaniem-clone">Kompromisy związane z używaniem <code>clone</code></a></h3>
<p>Wielu programistów Rusta ma tendencję do unikania używania <code>clone</code> do
naprawiania problemów z własnością ze względu na jego koszt wykonawczy.
W <a href="ch13-00-functional-features.html">Rozdziale 13</a><!-- ignore --> dowiesz się, jak używać bardziej
efektywnych metod w tego typu sytuacjach. Ale na razie w porządku jest
kopiowanie kilku ciągów znaków, aby kontynuować postęp, ponieważ te kopie
zrobisz tylko raz, a ścieżka pliku i ciąg zapytania są bardzo małe. Lepiej
mieć działający program, który jest nieco nieefektywny, niż próbować
hiperoptymalizować kod za pierwszym razem. W miarę zdobywania doświadczenia
z Rustem, łatwiej będzie zacząć od najbardziej efektywnego rozwiązania, ale na
razie, używanie <code>clone</code> jest całkowicie akceptowalne.</p>
</section>
<p>Zaktualizowaliśmy <code>main</code> tak, aby umieszczał instancję <code>Config</code> zwróconą przez
<code>parse_config</code> w zmiennej o nazwie <code>config</code>, i zaktualizowaliśmy kod, który
wcześniej używał oddzielnych zmiennych <code>query</code> i <code>file_path</code>, tak aby teraz
używał pól struktury <code>Config</code>.</p>
<p>Teraz nasz kod jaśniej przekazuje, że <code>query</code> i <code>file_path</code> są ze sobą
powiązane i że ich celem jest konfigurowanie działania programu. Każdy kod,
który używa tych wartości, wie, że znajdzie je w instancji <code>config</code> w polach
nazwanych zgodnie z ich przeznaczeniem.</p>
<h4 id="tworzenie-konstruktora-dla-config"><a class="header" href="#tworzenie-konstruktora-dla-config">Tworzenie konstruktora dla <code>Config</code></a></h4>
<p>Do tej pory wyodrębniliśmy logikę odpowiedzialną za parsowanie argumentów
wiersza poleceń z <code>main</code> i umieściliśmy ją w funkcji <code>parse_config</code>. Dzięki
temu zauważyliśmy, że wartości <code>query</code> i <code>file_path</code> były ze sobą powiązane,
i ten związek powinien być przekazany w naszym kodzie. Następnie dodaliśmy
strukturę <code>Config</code>, aby nazwać powiązane przeznaczenie <code>query</code> i <code>file_path</code>
oraz móc zwracać nazwy wartości jako nazwy pól struktury z funkcji
<code>parse_config</code>.</p>
<p>Skoro teraz celem funkcji <code>parse_config</code> jest stworzenie instancji <code>Config</code>,
możemy zmienić <code>parse_config</code> z prostej funkcji na funkcję o nazwie <code>new</code>,
która jest skojarzona ze strukturą <code>Config</code>. Ta zmiana sprawi, że kod będzie
bardziej idiomatyczny. Możemy tworzyć instancje typów w standardowej bibliotece,
takich jak <code>String</code>, wywołując <code>String::new</code>. Podobnie, zmieniając
<code>parse_config</code> na funkcję <code>new</code> skojarzoną z <code>Config</code>, będziemy mogli tworzyć
instancje <code>Config</code>, wywołując <code>Config::new</code>. Listing 12-7 pokazuje zmiany, które
musimy wprowadzić.</p>
<figure class="listing" id="listing-12-7">
<span class="file-name">Nazwa pliku: src/main.rs</span>
<pre><code class="language-rust should_panic noplayground"><span class="boring">use std::env;
</span><span class="boring">use std::fs;
</span><span class="boring">
</span>fn main() {
    let args: Vec&lt;String&gt; = env::args().collect();

    let config = Config::new(&amp;args);
<span class="boring">
</span><span class="boring">    println!("Searching for {}", config.query);
</span><span class="boring">    println!("In file {}", config.file_path);
</span><span class="boring">
</span><span class="boring">    let contents = fs::read_to_string(config.file_path)
</span><span class="boring">        .expect("Should have been able to read the file");
</span><span class="boring">
</span><span class="boring">    println!("With text:\n{contents}");
</span>
    // --snip--
}

// --snip--

<span class="boring">struct Config {
</span><span class="boring">    query: String,
</span><span class="boring">    file_path: String,
</span><span class="boring">}
</span><span class="boring">
</span>impl Config {
    fn new(args: &amp;[String]) -&gt; Config {
        let query = args[1].clone();
        let file_path = args[2].clone();

        Config { query, file_path }
    }
}</code></pre>
<figcaption><a href="#listing-12-7">Listing 12-7</a>: Zmiana <code>parse_config</code> na <code>Config::new</code></figcaption>
</figure>
<p>Zaktualizowaliśmy <code>main</code>, gdzie wywoływaliśmy <code>parse_config</code>, aby zamiast tego
wywoływać <code>Config::new</code>. Zmieniliśmy nazwę <code>parse_config</code> na <code>new</code> i przenieśliśmy
ją do bloku <code>impl</code>, co wiąże funkcję <code>new</code> z <code>Config</code>. Spróbuj ponownie
skompilować ten kod, aby upewnić się, że działa.</p>
<h3 id="naprawa-obsługi-błędów"><a class="header" href="#naprawa-obsługi-błędów">Naprawa obsługi błędów</a></h3>
<p>Teraz zajmiemy się naprawą obsługi błędów. Przypomnijmy, że próba uzyskania
dostępu do wartości w wektorze <code>args</code> pod indeksem 1 lub 2 spowoduje panikę
programu, jeśli wektor zawiera mniej niż trzy elementy. Spróbuj uruchomić
program bez żadnych argumentów; będzie to wyglądało tak:</p>
<pre><code class="language-console">$ cargo run
   Compiling minigrep v0.1.0 (file:///projects/minigrep)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.0s
     Running `target/debug/minigrep`

thread 'main' panicked at src/main.rs:27:21:
index out of bounds: the len is 1 but the index is 1
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre>
<p>Linia <code>index out of bounds: the len is 1 but the index is 1</code> to komunikat o
błędzie przeznaczony dla programistów. Nie pomoże on naszym użytkownikom
końcowym zrozumieć, co powinni zrobić zamiast tego. Naprawmy to teraz.</p>
<h4 id="ulepszanie-komunikatu-o-błędzie"><a class="header" href="#ulepszanie-komunikatu-o-błędzie">Ulepszanie komunikatu o błędzie</a></h4>
<p>W Listingu 12-8 dodajemy w funkcji <code>new</code> sprawdzenie, czy wycinek jest
wystarczająco długi, zanim uzyska dostęp do indeksu 1 i 2. Jeśli wycinek nie
jest wystarczająco długi, program panikuje i wyświetla lepszy komunikat o błędzie.</p>
<figure class="listing" id="listing-12-8">
<span class="file-name">Nazwa pliku: src/main.rs</span>
<pre><code class="language-rust ignore"><span class="boring">use std::env;
</span><span class="boring">use std::fs;
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let args: Vec&lt;String&gt; = env::args().collect();
</span><span class="boring">
</span><span class="boring">    let config = Config::new(&amp;args);
</span><span class="boring">
</span><span class="boring">    println!("Searching for {}", config.query);
</span><span class="boring">    println!("In file {}", config.file_path);
</span><span class="boring">
</span><span class="boring">    let contents = fs::read_to_string(config.file_path)
</span><span class="boring">        .expect("Should have been able to read the file");
</span><span class="boring">
</span><span class="boring">    println!("With text:\n{contents}");
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">struct Config {
</span><span class="boring">    query: String,
</span><span class="boring">    file_path: String,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Config {
</span>    // --snip--
    fn new(args: &amp;[String]) -&gt; Config {
        if args.len() &lt; 3 {
            panic!("not enough arguments");
        }
        // --snip--
<span class="boring">
</span><span class="boring">        let query = args[1].clone();
</span><span class="boring">        let file_path = args[2].clone();
</span><span class="boring">
</span><span class="boring">        Config { query, file_path }
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<figcaption><a href="#listing-12-8">Listing 12-8</a>: Dodawanie sprawdzenia liczby argumentów</figcaption>
</figure>
<p>Ten kod jest podobny do <a href="ch09-03-to-panic-or-not-to-panic.html#creating-custom-types-for-validation">funkcji <code>Guess::new</code>, którą napisaliśmy w Listingu
9-13</a><!-- ignore -->, gdzie wywołaliśmy <code>panic!</code>, gdy
argument <code>value</code> był poza zakresem prawidłowych wartości. Zamiast sprawdzać
zakres wartości tutaj, sprawdzamy, czy długość <code>args</code> wynosi co najmniej <code>3</code>,
a reszta funkcji może działać, zakładając, że ten warunek został spełniony.
Jeśli <code>args</code> ma mniej niż trzy elementy, ten warunek będzie <code>true</code> i wywołamy
makro <code>panic!</code>, aby natychmiast zakończyć program.</p>
<p>Z tymi dodatkowymi kilkoma liniami kodu w <code>new</code>, uruchommy program ponownie bez
żadnych argumentów, aby zobaczyć, jak teraz wygląda błąd:</p>
<pre><code class="language-console">$ cargo run
   Compiling minigrep v0.1.0 (file:///projects/minigrep)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.0s
     Running `target/debug/minigrep`

thread 'main' panicked at src/main.rs:26:13:
not enough arguments
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre>
<p>Ten wynik jest lepszy: mamy teraz rozsądny komunikat o błędzie. Mamy jednak
także zbędne informacje, których nie chcemy przekazywać naszym użytkownikom.
Być może technika, której użyliśmy w Listingu 9-13, nie jest tutaj najlepsza:
wywołanie <code>panic!</code> jest bardziej odpowiednie dla problemu programistycznego niż
problemu z użyciem, <a href="ch09-03-to-panic-or-not-to-panic.html#guidelines-for-error-handling">jak omówiono w Rozdziale
9</a><!-- ignore -->. Zamiast tego, użyjemy innej
techniki, o której dowiedziałeś się w Rozdziale 9 – <a href="ch09-02-recoverable-errors-with-result.html">zwracania
<code>Result</code></a><!-- ignore -->, który wskazuje na sukces lub błąd.</p>
<!-- Old headings. Do not remove or links may break. -->
<p><a id="returning-a-result-from-new-instead-of-calling-panic"></a></p>
<h4 id="zwracanie-result-zamiast-wywoływania-panic"><a class="header" href="#zwracanie-result-zamiast-wywoływania-panic">Zwracanie <code>Result</code> zamiast wywoływania <code>panic!</code></a></h4>
<p>Zamiast tego możemy zwrócić wartość <code>Result</code>, która będzie zawierała instancję
<code>Config</code> w przypadku sukcesu i będzie opisywać problem w przypadku błędu.
Zmienimy również nazwę funkcji z <code>new</code> na <code>build</code>, ponieważ wielu
programistów oczekuje, że funkcje <code>new</code> nigdy nie zawiodą. Kiedy <code>Config::build</code>
komunikuje się z <code>main</code>, możemy użyć typu <code>Result</code>, aby zasygnalizować,
że wystąpił problem. Następnie możemy zmienić <code>main</code>, aby przekształcić
wariant <code>Err</code> w bardziej praktyczny błąd dla naszych użytkowników, bez
otaczającego tekstu o <code>thread 'main'</code> i <code>RUST_BACKTRACE</code>, które powoduje
wywołanie <code>panic!</code>.</p>
<p>Listing 12-9 pokazuje zmiany, które musimy wprowadzić w wartości zwracanej
funkcji, którą teraz nazywamy <code>Config::build</code>, oraz w ciele funkcji
potrzebnym do zwrócenia <code>Result</code>. Zauważ, że to się nie skompiluje, dopóki nie
zaktualizujemy również <code>main</code>, co zrobimy w następnym listingu.</p>
<figure class="listing" id="listing-12-9">
<span class="file-name">Nazwa pliku: src/main.rs</span>
<pre><code class="language-rust ignore does_not_compile"><span class="boring">use std::env;
</span><span class="boring">use std::fs;
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let args: Vec&lt;String&gt; = env::args().collect();
</span><span class="boring">
</span><span class="boring">    let config = Config::new(&amp;args);
</span><span class="boring">
</span><span class="boring">    println!("Searching for {}", config.query);
</span><span class="boring">    println!("In file {}", config.file_path);
</span><span class="boring">
</span><span class="boring">    let contents = fs::read_to_string(config.file_path)
</span><span class="boring">        .expect("Should have been able to read the file");
</span><span class="boring">
</span><span class="boring">    println!("With text:\n{contents}");
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">struct Config {
</span><span class="boring">    query: String,
</span><span class="boring">    file_path: String,
</span><span class="boring">}
</span><span class="boring">
</span>impl Config {
    fn build(args: &amp;[String]) -&gt; Result&lt;Config, &amp;'static str&gt; {
        if args.len() &lt; 3 {
            return Err("not enough arguments");
        }

        let query = args[1].clone();
        let file_path = args[2].clone();

        Ok(Config { query, file_path })
    }
}</code></pre>
<figcaption><a href="#listing-12-9">Listing 12-9</a>: Zwracanie <code>Result</code> z <code>Config::build</code></figcaption>
</figure>
<p>Nasza funkcja <code>build</code> zwraca <code>Result</code> z instancją <code>Config</code> w przypadku
pomyślności i literałem ciągu znaków w przypadku błędu. Nasze wartości błędów
będą zawsze literałami ciągu znaków, które mają czas życia <code>'static</code>.</p>
<p>Dokonaliśmy dwóch zmian w ciele funkcji: zamiast wywoływać <code>panic!</code> gdy
użytkownik nie przekaże wystarczającej liczby argumentów, teraz zwracamy
wartość <code>Err</code>, a wartość zwracaną <code>Config</code> opakowaliśmy w <code>Ok</code>. Te zmiany
sprawiają, że funkcja jest zgodna z nowym podpisem typu.</p>
<p>Zwracanie wartości <code>Err</code> z <code>Config::build</code> pozwala funkcji <code>main</code> obsłużyć
wartość <code>Result</code> zwróconą z funkcji <code>build</code> i czysto zakończyć proces w
przypadku błędu.</p>
<!-- Old headings. Do not remove or links may break. -->
<p><a id="calling-confignew-and-handling-errors"></a></p>
<h4 id="wywoływanie-configbuild-i-obsługa-błędów"><a class="header" href="#wywoływanie-configbuild-i-obsługa-błędów">Wywoływanie <code>Config::build</code> i obsługa błędów</a></h4>
<p>Aby obsłużyć przypadek błędu i wyświetlić komunikat zrozumiały dla użytkownika,
musimy zaktualizować <code>main</code> w celu obsługi <code>Result</code> zwracanego przez
<code>Config::build</code>, jak pokazano w Listingu 12-10. Przejmiemy również
odpowiedzialność za zakończenie narzędzia wiersza poleceń z niezerowym kodem
błędu zamiast <code>panic!</code> i zaimplementujemy to ręcznie. Niezerowy status
wyjścia jest konwencją sygnalizującą procesowi, który wywołał nasz program, że
program zakończył działanie ze stanem błędu.</p>
<figure class="listing" id="listing-12-10">
<span class="file-name">Nazwa pliku: src/main.rs</span>
<pre><code class="language-rust ignore"><span class="boring">use std::env;
</span><span class="boring">use std::fs;
</span>use std::process;

fn main() {
    let args: Vec&lt;String&gt; = env::args().collect();

    let config = Config::build(&amp;args).unwrap_or_else(|err| {
        println!("Problem parsing arguments: {err}");
        process::exit(1);
    });

    // --snip--
<span class="boring">
</span><span class="boring">    println!("Searching for {}", config.query);
</span><span class="boring">    println!("In file {}", config.file_path);
</span><span class="boring">
</span><span class="boring">    let contents = fs::read_to_string(config.file_path)
</span><span class="boring">        .expect("Should have been able to read the file");
</span><span class="boring">
</span><span class="boring">    println!("With text:\n{contents}");
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">struct Config {
</span><span class="boring">    query: String,
</span><span class="boring">    file_path: String,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Config {
</span><span class="boring">    fn build(args: &amp;[String]) -&gt; Result&lt;Config, &amp;'static str&gt; {
</span><span class="boring">        if args.len() &lt; 3 {
</span><span class="boring">            return Err("not enough arguments");
</span><span class="boring">        }
</span><span class="boring">
</span><span class="boring">        let query = args[1].clone();
</span><span class="boring">        let file_path = args[2].clone();
</span><span class="boring">
</span><span class="boring">        Ok(Config { query, file_path })
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<figcaption><a href="#listing-12-10">Listing 12-10</a>: Wyjście z kodem błędu, jeśli budowanie <code>Config</code> zawiedzie</figcaption>
</figure>
<p>W tym listingu użyliśmy metody, której jeszcze szczegółowo nie omówiliśmy:
<code>unwrap_or_else</code>, która jest zdefiniowana w <code>Result&lt;T, E&gt;</code> przez standardową
bibliotekę. Użycie <code>unwrap_or_else</code> pozwala nam zdefiniować niestandardową,
nie-<code>panic!</code> obsługę błędów. Jeśli <code>Result</code> jest wartością <code>Ok</code>, zachowanie
tej metody jest podobne do <code>unwrap</code>: zwraca wewnętrzną wartość, którą opakowuje
<code>Ok</code>. Jednak jeśli wartość jest wartością <code>Err</code>, ta metoda wywołuje kod w
zamknięciu, które jest anonimową funkcją, którą definiujemy i przekazujemy jako
argument do <code>unwrap_or_else</code>. Zamknięcia omówimy bardziej szczegółowo w
<a href="ch13-00-functional-features.html">Rozdziale 13</a><!-- ignore -->. Na razie wystarczy wiedzieć, że
<code>unwrap_or_else</code> przekaże wewnętrzną wartość <code>Err</code>, która w tym przypadku jest
statycznym ciągiem znaków <code>"not enough arguments"</code>, który dodaliśmy w Listingu
12-9, do naszego zamknięcia w argumencie <code>err</code>, który pojawia się między
pionowymi kreskami. Kod w zamknięciu może następnie użyć wartości <code>err</code>, gdy
będzie działał.</p>
<p>Dodaliśmy nową linię <code>use</code>, aby wprowadzić <code>process</code> ze standardowej biblioteki
do zakresu. Kod w zamknięciu, który zostanie uruchomiony w przypadku błędu,
składa się tylko z dwóch linii: wyświetlamy <code>err</code>, a następnie wywołujemy
<code>process::exit</code>. Funkcja <code>process::exit</code> natychmiast zatrzyma program i zwróci
liczbę, która została przekazana jako kod statusu wyjścia. Jest to podobne do
obsługi opartej na <code>panic!</code>, której użyliśmy w Listingu 12-8, ale nie
otrzymujemy już wszystkich dodatkowych danych wyjściowych. Spróbujmy:</p>
<pre><code class="language-console">$ cargo run
   Compiling minigrep v0.1.0 (file:///projects/minigrep)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.48s
     Running `target/debug/minigrep`
Problem parsing arguments: not enough arguments
</code></pre>
<p>Świetnie! Ten wynik jest znacznie bardziej przyjazny dla naszych użytkowników.</p>
<!-- Old headings. Do not remove or links may break. -->
<p><a id="extracting-logic-from-the-main-function"></a></p>
<h3 id="wyodrębnianie-logiki-z-funkcji-main"><a class="header" href="#wyodrębnianie-logiki-z-funkcji-main">Wyodrębnianie logiki z funkcji <code>main</code></a></h3>
<p>Teraz, gdy zakończyliśmy refaktoryzację parsowania konfiguracji, zajmijmy się
logiką programu. Jak stwierdziliśmy w sekcji <a href="#separation-of-concerns-for-binary-projects">„Rozdzielanie odpowiedzialności w
projektach binarnych”</a><!--
ignore -->, wyodrębnimy funkcję o nazwie <code>run</code>, która będzie zawierała całą
logikę znajdującą się obecnie w funkcji <code>main</code>, niezwiązaną z konfigurowaniem
ani obsługą błędów. Po zakończeniu funkcja <code>main</code> będzie zwięzła i łatwa do
weryfikacji poprzez inspekcję, a my będziemy mogli pisać testy dla całej
pPozostałej logiki.</p>
<p>Listing 12-11 pokazuje niewielką, przyrostową poprawę w wyodrębnianiu funkcji
<code>run</code>.</p>
<figure class="listing" id="listing-12-11">
<span class="file-name">Nazwa pliku: src/main.rs</span>
<pre><code class="language-rust ignore"><span class="boring">use std::env;
</span><span class="boring">use std::fs;
</span><span class="boring">use std::process;
</span><span class="boring">
</span>fn main() {
    // --snip--

<span class="boring">    let args: Vec&lt;String&gt; = env::args().collect();
</span><span class="boring">
</span><span class="boring">    let config = Config::build(&amp;args).unwrap_or_else(|err| {
</span><span class="boring">        println!("Problem parsing arguments: {err}");
</span><span class="boring">        process::exit(1);
</span><span class="boring">    });
</span><span class="boring">
</span>    println!("Searching for {}", config.query);
    println!("In file {}", config.file_path);

    run(config);
}

fn run(config: Config) {
    let contents = fs::read_to_string(config.file_path)
        .expect("Should have been able to read the file");

    println!("With text:\n{contents}");
}

// --snip--
<span class="boring">
</span><span class="boring">struct Config {
</span><span class="boring">    query: String,
</span><span class="boring">    file_path: String,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Config {
</span><span class="boring">    fn build(args: &amp;[String]) -&gt; Result&lt;Config, &amp;'static str&gt; {
</span><span class="boring">        if args.len() &lt; 3 {
</span><span class="boring">            return Err("not enough arguments");
</span><span class="boring">        }
</span><span class="boring">
</span><span class="boring">        let query = args[1].clone();
</span><span class="boring">        let file_path = args[2].clone();
</span><span class="boring">
</span><span class="boring">        Ok(Config { query, file_path })
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<figcaption><a href="#listing-12-11">Listing 12-11</a>: Wyodrębnianie funkcji <code>run</code> zawierającej resztę logiki programu</figcaption>
</figure>
<p>Funkcja <code>run</code> zawiera teraz całą pozostałą logikę z <code>main</code>, poczynając od
樑odczytu pliku. Funkcja <code>run</code> przyjmuje instancję <code>Config</code> jako argument.</p>
<!-- Old headings. Do not remove or links may break. -->
<p><a id="returning-errors-from-the-run-function"></a></p>
<h4 id="zwracanie-błędów-z-funkcji-run"><a class="header" href="#zwracanie-błędów-z-funkcji-run">Zwracanie błędów z funkcji <code>run</code></a></h4>
<p>Po oddzieleniu pozostałej logiki programu do funkcji <code>run</code>, możemy poprawić
obsługę błędów, tak jak to zrobiliśmy z <code>Config::build</code> w Listingu 12-9.
Zamiast pozwalać programowi na panikę poprzez wywołanie <code>expect</code>, funkcja
<code>run</code> będzie zwracać <code>Result&lt;T, E&gt;</code>, gdy coś pójdzie nie tak. Pozwoli to nam
dalej skonsolidować logikę obsługi błędów w <code>main</code> w sposób przyjazny dla
użytkownika. Listing 12-12 pokazuje zmiany, które musimy wprowadzić w sygnaturze
i ciele <code>run</code>.</p>
<figure class="listing" id="listing-12-12">
<span class="file-name">Nazwa pliku: src/main.rs</span>
<pre><code class="language-rust ignore"><span class="boring">use std::env;
</span><span class="boring">use std::fs;
</span><span class="boring">use std::process;
</span>use std::error::Error;

// --snip--

<span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let args: Vec&lt;String&gt; = env::args().collect();
</span><span class="boring">
</span><span class="boring">    let config = Config::build(&amp;args).unwrap_or_else(|err| {
</span><span class="boring">        println!("Problem parsing arguments: {err}");
</span><span class="boring">        process::exit(1);
</span><span class="boring">    });
</span><span class="boring">
</span><span class="boring">    println!("Searching for {}", config.query);
</span><span class="boring">    println!("In file {}", config.file_path);
</span><span class="boring">
</span><span class="boring">    run(config);
</span><span class="boring">}
</span><span class="boring">
</span>fn run(config: Config) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
    let contents = fs::read_to_string(config.file_path)?;

    println!("With text:\n{contents}");

    Ok(())
}
<span class="boring">
</span><span class="boring">struct Config {
</span><span class="boring">    query: String,
</span><span class="boring">    file_path: String,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Config {
</span><span class="boring">    fn build(args: &amp;[String]) -&gt; Result&lt;Config, &amp;'static str&gt; {
</span><span class="boring">        if args.len() &lt; 3 {
</span><span class="boring">            return Err("not enough arguments");
</span><span class="boring">        }
</span><span class="boring">
</span><span class="boring">        let query = args[1].clone();
</span><span class="boring">        let file_path = args[2].clone();
</span><span class="boring">
</span><span class="boring">        Ok(Config { query, file_path })
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<figcaption><a href="#listing-12-12">Listing 12-12</a>: Zmiana funkcji <code>run</code> na zwracającą <code>Result</code></figcaption>
</figure>
<p>Wprowadziliśmy tu trzy istotne zmiany. Po pierwsze, zmieniliśmy typ zwracany
funkcji <code>run</code> na <code>Result&lt;(), Box&lt;dyn Error&gt;&gt;</code>. Ta funkcja wcześniej zwracała
typ jednostkowy <code>()</code>, i zachowujemy to jako wartość zwracaną w przypadku <code>Ok</code>.</p>
<p>Jako typ błędu użyliśmy obiektu cechy <code>Box&lt;dyn Error&gt;</code> (i wprowadziliśmy
<code>std::error::Error</code> do zakresu za pomocą instrukcji <code>use</code> na górze). Obiekty
cech omówimy w <a href="ch18-00-oop.html">Rozdziale 18</a><!-- ignore -->. Na razie wystarczy wiedzieć,
że <code>Box&lt;dyn Error&gt;</code> oznacza, że funkcja zwróci typ, który implementuje cechę
<code>Error</code>, ale nie musimy określać, jaki konkretny typ będzie miała wartość
zwracana. Daje nam to elastyczność w zwracaniu wartości błędów, które mogą być
różnych typów w różnych przypadkach błędów. Słowo kluczowe <code>dyn</code> to skrót od
<em>dynamiczny</em>.</p>
<p>Po drugie, usunęliśmy wywołanie <code>expect</code> na rzecz operatora <code>?</code>, o czym
mówiliśmy w <a href="ch09-02-recoverable-errors-with-result.html#a-shortcut-for-propagating-errors-the--operator">Rozdziale 9</a><!-- ignore -->. Zamiast panikować
w przypadku błędu, <code>?</code> zwróci wartość błędu z bieżącej funkcji, aby wywołujący
mógł ją obsłużyć.</p>
<p>Po trzecie, funkcja <code>run</code> zwraca teraz wartość <code>Ok</code> w przypadku sukcesu.
Zadeklarowaliśmy typ sukcesu funkcji <code>run</code> jako <code>()</code> w sygnaturze, co oznacza,
że musimy opakować wartość typu jednostkowego w wartość <code>Ok</code>. Ta składnia
<code>Ok(())</code> może na początku wydawać się nieco dziwna. Ale użycie <code>()</code> w ten sposób
jest idiomatycznym sposobem wskazania, że wywołujemy <code>run</code> tylko dla jego
efektów ubocznych; nie zwraca on wartości, której potrzebujemy.</p>
<p>Kiedy uruchomisz ten kod, skompiluje się, ale wyświetli ostrzeżenie:</p>
<pre><code class="language-console">$ cargo run -- the poem.txt
   Compiling minigrep v0.1.0 (file:///projects/minigrep)
warning: unused `Result` that must be used
  --&gt; src/main.rs:19:5
   |
19 |     run(config);
   |     ^^^^^^^^^^^
   |
   = note: this `Result` may be an `Err` variant, which should be handled
   = note: `#[warn(unused_must_use)]` on by default
help: use `let _ = ...` to ignore the resulting value
   |
19 |     let _ = run(config);
   |     +++++++

warning: `minigrep` (bin "minigrep") generated 1 warning
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.71s
     Running `target/debug/minigrep the poem.txt`
Searching for the
In file poem.txt
With text:
I'm nobody! Who are you?
Are you nobody, too?
Then there's a pair of us - don't tell!
They'd banish us, you know.

How dreary to be somebody!
How public, like a frog
To tell your name the livelong day
To an admiring bog!

</code></pre>
<p>Rust informuje nas, że nasz kod zignorował wartość <code>Result</code> i że wartość
<code>Result</code> może wskazywać na wystąpienie błędu. Ale nie sprawdzamy, czy wystąpił
błąd, a kompilator przypomina nam, że prawdopodobnie zamierzaliśmy umieścić
tutaj jakiś kod do obsługi błędów! Naprawmy ten problem teraz.</p>
<h4 id="obsługa-błędów-zwracanych-przez-run-w-main"><a class="header" href="#obsługa-błędów-zwracanych-przez-run-w-main">Obsługa błędów zwracanych przez <code>run</code> w <code>main</code></a></h4>
<p>Sprawdzimy błędy i obsłużymy je za pomocą techniki podobnej do tej, której
użyliśmy z <code>Config::build</code> w Listingu 12-10, ale z niewielką różnicą:</p>
<p><span class="filename">Nazwa pliku: src/main.rs</span></p>
<pre><code class="language-rust ignore"><span class="boring">use std::env;
</span><span class="boring">use std::error::Error;
</span><span class="boring">use std::fs;
</span><span class="boring">use std::process;
</span><span class="boring">
</span>fn main() {
    // --snip--

<span class="boring">    let args: Vec&lt;String&gt; = env::args().collect();
</span><span class="boring">
</span><span class="boring">    let config = Config::build(&amp;args).unwrap_or_else(|err| {
</span><span class="boring">        println!("Problem parsing arguments: {err}");
</span><span class="boring">        process::exit(1);
</span><span class="boring">    });
</span><span class="boring">
</span>    println!("Searching for {}", config.query);
    println!("In file {}", config.file_path);

    if let Err(e) = run(config) {
        println!("Application error: {e}");
        process::exit(1);
    }
}
<span class="boring">
</span><span class="boring">fn run(config: Config) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
</span><span class="boring">    let contents = fs::read_to_string(config.file_path)?;
</span><span class="boring">
</span><span class="boring">    println!("With text:\n{contents}");
</span><span class="boring">
</span><span class="boring">    Ok(())
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">struct Config {
</span><span class="boring">    query: String,
</span><span class="boring">    file_path: String,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Config {
</span><span class="boring">    fn build(args: &amp;[String]) -&gt; Result&lt;Config, &amp;'static str&gt; {
</span><span class="boring">        if args.len() &lt; 3 {
</span><span class="boring">            return Err("not enough arguments");
</span><span class="boring">        }
</span><span class="boring">
</span><span class="boring">        let query = args[1].clone();
</span><span class="boring">        let file_path = args[2].clone();
</span><span class="boring">
</span><span class="boring">        Ok(Config { query, file_path })
</span><span class="boring">    }
</span><span class="boring">}</span></code></pre>
<p>Używamy <code>if let</code> zamiast <code>unwrap_or_else</code>, aby sprawdzić, czy <code>run</code> zwraca
wartość <code>Err</code>, i aby wywołać <code>process::exit(1)</code>, jeśli tak. Funkcja <code>run</code> nie
zwraca wartości, którą chcemy <code>unwrap</code> w taki sam sposób, w jaki
<code>Config::build</code> zwraca instancję <code>Config</code>. Ponieważ <code>run</code> zwraca <code>()</code> w
przypadku sukcesu, zależy nam tylko na wykryciu błędu, więc nie potrzebujemy
<code>unwrap_or_else</code>, aby zwrócić rozpakowaną wartość, która byłaby tylko <code>()</code>.</p>
<p>Ciała funkcji <code>if let</code> i <code>unwrap_or_else</code> są w obu przypadkach takie same:
wyświetlamy błąd i wychodzimy.</p>
<h3 id="podział-kodu-na-bibliotekę-typu-crate"><a class="header" href="#podział-kodu-na-bibliotekę-typu-crate">Podział kodu na bibliotekę typu “crate”</a></h3>
<p>Nasz projekt <code>minigrep</code> wygląda do tej pory dobrze! Teraz podzielimy plik
<em>src/main.rs</em> i umieścimy część kodu w pliku <em>src/lib.rs</em>. W ten sposób możemy
testować kod i mieć plik <em>src/main.rs</em> z mniejszą odpowiedzialnością.</p>
<p>Zdefiniujmy kod odpowiedzialny za wyszukiwanie tekstu w <em>src/lib.rs</em> zamiast w
<em>src/main.rs</em>, co pozwoli nam (lub każdemu innemu, kto używa naszej biblioteki
<code>minigrep</code>) wywołać funkcję wyszukiwania z większej liczby kontekstów niż nasz
plik binarny <code>minigrep</code>.</p>
<p>Najpierw zdefiniujmy sygnaturę funkcji <code>search</code> w <em>src/lib.rs</em>, jak pokazano w
Listingu 12-13, z ciałem, które wywołuje makro <code>unimplemented!</code>. Wyjaśnimy
sygnaturę bardziej szczegółowo, gdy wypełnimy implementację.</p>
<figure class="listing" id="listing-12-13">
<span class="file-name">Nazwa pliku: src/lib.rs</span>
<pre><code class="language-rust ignore does_not_compile">pub fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {
    unimplemented!();
}</code></pre>
<figcaption><a href="#listing-12-13">Listing 12-13</a>: Definiowanie funkcji <code>search</code> w <em>src/lib.rs</em></figcaption>
</figure>
<p>Użyliśmy słowa kluczowego <code>pub</code> w definicji funkcji, aby oznaczyć <code>search</code> jako
część publicznego API naszego pakietu bibliotecznego. Mamy teraz pakiet
biblioteczny, którego możemy używać z naszego pakietu binarnego i który możemy
testować!</p>
<p>Teraz musimy wprowadzić kod zdefiniowany w <em>src/lib.rs</em> do zakresu pakietu
binarnego w <em>src/main.rs</em> i wywołać go, jak pokazano w Listingu 12-14.</p>
<figure class="listing" id="listing-12-14">
<span class="file-name">Nazwa pliku: src/main.rs</span>
<pre><code class="language-rust ignore"><span class="boring">use std::env;
</span><span class="boring">use std::error::Error;
</span><span class="boring">use std::fs;
</span><span class="boring">use std::process;
</span><span class="boring">
</span>// --snip--
use minigrep::search;

fn main() {
    // --snip--
<span class="boring">    let args: Vec&lt;String&gt; = env::args().collect();
</span><span class="boring">
</span><span class="boring">    let config = Config::build(&amp;args).unwrap_or_else(|err| {
</span><span class="boring">        println!("Problem parsing arguments: {err}");
</span><span class="boring">        process::exit(1);
</span><span class="boring">    });
</span><span class="boring">
</span><span class="boring">    if let Err(e) = run(config) {
</span><span class="boring">        println!("Application error: {e}");
</span><span class="boring">        process::exit(1);
</span><span class="boring">    }
</span>}

// --snip--

<span class="boring">
</span><span class="boring">struct Config {
</span><span class="boring">    query: String,
</span><span class="boring">    file_path: String,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl Config {
</span><span class="boring">    fn build(args: &amp;[String]) -&gt; Result&lt;Config, &amp;'static str&gt; {
</span><span class="boring">        if args.len() &lt; 3 {
</span><span class="boring">            return Err("not enough arguments");
</span><span class="boring">        }
</span><span class="boring">
</span><span class="boring">        let query = args[1].clone();
</span><span class="boring">        let file_path = args[2].clone();
</span><span class="boring">
</span><span class="boring">        Ok(Config { query, file_path })
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span>fn run(config: Config) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
    let contents = fs::read_to_string(config.file_path)?;

    for line in search(&amp;config.query, &amp;contents) {
        println!("{line}");
    }

    Ok(())
}</code></pre>
<figcaption><a href="#listing-12-14">Listing 12-14</a>: Użycie funkcji <code>search</code> z biblioteki <code>minigrep</code> w <em>src/main.rs</em></figcaption>
</figure>
<p>Dodajemy linię <code>use minigrep::search</code>, aby wprowadzić funkcję <code>search</code> z
pakietu bibliotecznego do zakresu pakietu binarnego. Następnie, w funkcji <code>run</code>,
zamiast wypisywać zawartość pliku, wywołujemy funkcję <code>search</code> i przekazujemy
wartość <code>config.query</code> oraz <code>contents</code> jako argumenty. Następnie <code>run</code> użyje
pętli <code>for</code> do wypisania każdej linii zwróconej przez <code>search</code>, która
dopasowała zapytanie. To również dobry moment na usunięcie wywołań
<code>println!</code> w funkcji <code>main</code>, które wyświetlały zapytanie i ścieżkę pliku, tak
aby nasz program wyświetlał tylko wyniki wyszukiwania (jeśli nie wystąpiły
błędy).</p>
<p>Zauważ, że funkcja wyszukiwania będzie zbierać wszystkie wyniki do zwracanego
wektora, zanim rozpocznie się jakiekolwiek drukowanie. Ta implementacja może
być powolna w wyświetlaniu wyników podczas wyszukiwania w dużych plikach,
ponieważ wyniki nie są drukowane w miarę ich znajdowania; omówimy możliwy
sposób rozwiązania tego problemu za pomocą iteratorów w Rozdziale 13.</p>
<p>Uff! To była ciężka praca, ale przygotowaliśmy się na przyszłość. Teraz o wiele
łatwiej jest obsługiwać błędy, a kod uczyniliśmy bardziej modułowym.
Prawie cała nasza praca będzie wykonywana w <em>src/lib.rs</em> od teraz.</p>
<p>Wykorzystajmy tę nowo odkrytą modułowość, robiąc coś, co byłoby trudne ze
starym kodem, ale jest łatwe z nowym: napiszemy kilka testów!</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="ch12-02-reading-a-file.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="ch12-04-testing-the-librarys-functionality.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="ch12-02-reading-a-file.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="ch12-04-testing-the-librarys-functionality.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->
        <script src="ferris-2317480c.js"></script>



    </div>
    </body>
</html>
