<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Stosowanie współbieżności z &#x60;async&#x60; - Język programowania Rust</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="ferris-d33b75bf.css">
        <link rel="stylesheet" href="theme/2018-edition-4e126c62.css">
        <link rel="stylesheet" href="theme/semantic-notes-9b5766c0.css">
        <link rel="stylesheet" href="theme/listing-cab26221.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-773dca2f.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-039e37ba.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">Język programowania Rust</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/rust-lang/book" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <!-- Old headings. Do not remove or links may break. -->
<p><a id="concurrency-with-async"></a></p>
<h2 id="stosowanie-współbieżności-z-async"><a class="header" href="#stosowanie-współbieżności-z-async">Stosowanie współbieżności z <code>async</code></a></h2>
<p>W tej sekcji zastosujemy async do niektórych z tych samych wyzwań
współbieżności, które rozwiązaliśmy za pomocą wątków w Rozdziale 16. Ponieważ
wiele kluczowych idei zostało tam już omówionych, w tej sekcji skupimy się na
różnicach między wątkami a futures.</p>
<p>W wielu przypadkach API do pracy z współbieżnością przy użyciu async są bardzo
podobne do tych do pracy z wątkami. W innych przypadkach są one zupełnie
różne. Nawet gdy API <em>wyglądają</em> podobnie między wątkami a async, często mają
różne zachowania — i prawie zawsze mają różne charakterystyki wydajności.</p>
<!-- Old headings. Do not remove or links may break. -->
<p><a id="counting"></a></p>
<h3 id="tworzenie-nowego-zadania-za-pomocą-spawn_task"><a class="header" href="#tworzenie-nowego-zadania-za-pomocą-spawn_task">Tworzenie nowego zadania za pomocą <code>spawn_task</code></a></h3>
<p>Pierwszą operacją, którą zajęliśmy się w sekcji <a href="ch16-01-threads.html#creating-a-new-thread-with-spawn">„Tworzenie nowego wątku za
pomocą <code>spawn</code>”</a><!-- ignore --> w Rozdziale 16, było zliczanie
na dwóch oddzielnych wątkach. Zróbmy to samo, używając async. Crate <code>trpl</code>
dostarcza funkcję <code>spawn_task</code>, która wygląda bardzo podobnie do API
<code>thread::spawn</code>, oraz funkcję <code>sleep</code>, która jest asynchroniczną wersją API
<code>thread::sleep</code>. Możemy ich użyć razem do zaimplementowania przykładu
zliczania, jak pokazano w Listingu 17-6.</p>
<listing number="17-6" caption="Tworzenie nowego zadania do wypisania jednej rzeczy, podczas gdy główne zadanie wypisuje coś innego" file-name="src/main.rs">
<pre class="playground"><code class="language-rust edition2024"><span class="boring">extern crate trpl; // required for mdbook test
</span><span class="boring">
</span>use std::time::Duration;

fn main() {
    trpl::block_on(async {
        trpl::spawn_task(async {
            for i in 1..10 {
                println!("hi number {i} from the first task!");
                trpl::sleep(Duration::from_millis(500)).await;
            }
        });

        for i in 1..5 {
            println!("hi number {i} from the second task!");
            trpl::sleep(Duration::from_millis(500)).await;
        }
    });
}</code></pre>
</listing>
<p>Jako punkt wyjścia, konfigurujemy naszą funkcję <code>main</code> z <code>trpl::block_on</code>,
tak aby nasza funkcja najwyższego poziomu mogła być asynchroniczna.</p>
<blockquote>
<p>Uwaga: Od tego momentu w rozdziale, każdy przykład będzie zawierał ten sam
kod opakowujący z <code>trpl::block_on</code> w <code>main</code>, więc często będziemy go
pomijać, tak jak to robimy z <code>main</code>. Pamiętaj, aby uwzględnić go w swoim
kodzie!</p>
</blockquote>
<p>Następnie piszemy dwie pętle w tym bloku, każda zawierająca wywołanie
<code>trpl::sleep</code>, które czeka pół sekundy (500 milisekund) przed wysłaniem
kolejnej wiadomości. Jedną pętlę umieszczamy w ciele <code>trpl::spawn_task</code>, a drugą
w pętli <code>for</code> najwyższego poziomu. Dodajemy również <code>await</code> po wywołaniach
<code>sleep</code>.</p>
<p>Ten kod zachowuje się podobnie do implementacji opartej na wątkach – w tym
także to, że możesz zobaczyć wiadomości pojawiające się w innej kolejności w
własnym terminalu, gdy go uruchomisz:</p>
<!-- Not extracting output because changes to this output aren't significant;
the changes are likely to be due to the threads running differently rather than
changes in the compiler -->
<pre><code class="language-text">hi number 1 from the second task!
hi number 1 from the first task!
hi number 2 from the first task!
hi number 2 from the second task!
hi number 3 from the first task!
hi number 3 from the second task!
hi number 4 from the first task!
hi number 4 from the second task!
hi number 5 from the first task!
</code></pre>
<p>Ta wersja zatrzymuje się, gdy tylko zakończy się pętla <code>for</code> w ciele głównego
bloku async, ponieważ zadanie uruchomione przez <code>spawn_task</code> zostaje
wyłączone, gdy funkcja <code>main</code> się kończy. Jeśli chcesz, aby działało do końca
zadania, będziesz musiał użyć uchwytu <code>join</code> do oczekiwania na zakończenie
pierwszego zadania. W przypadku wątków, użyliśmy metody <code>join</code> do „blokowania”,
dopóki wątek nie zakończył działania. W Listingu 17-7 możemy użyć <code>await</code> do
zrobienia tego samego, ponieważ sam uchwyt zadania jest future. Jego typ
<code>Output</code> to <code>Result</code>, więc również go rozpakowujemy po oczekiwaniu na niego.</p>
<listing number="17-7" caption="Użycie `await` z uchwytem `join` do uruchomienia zadania do końca" file-name="src/main.rs">
<pre class="playground"><code class="language-rust edition2024"><span class="boring">extern crate trpl; // required for mdbook test
</span><span class="boring">
</span><span class="boring">use std::time::Duration;
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    trpl::block_on(async {
</span>        let handle = trpl::spawn_task(async {
            for i in 1..10 {
                println!("hi number {i} from the first task!");
                trpl::sleep(Duration::from_millis(500)).await;
            }
        });

        for i in 1..5 {
            println!("hi number {i} from the second task!");
            trpl::sleep(Duration::from_millis(500)).await;
        }

        handle.await.unwrap();
<span class="boring">    });
</span><span class="boring">}</span></code></pre>
</listing>
<p>Ta zaktualizowana wersja działa, dopóki <em>obie</em> pętle się nie zakończą:</p>
<!-- Not extracting output because changes to this output aren't significant;
the changes are likely to be due to the threads running differently rather than
changes in the compiler -->
<pre><code class="language-text">hi number 1 from the second task!
hi number 1 from the first task!
hi number 2 from the first task!
hi number 2 from the second task!
hi number 3 from the first task!
hi number 3 from the second task!
hi number 4 from the first task!
hi number 4 from the second task!
hi number 5 from the first task!
hi number 6 from the first task!
hi number 7 from the first task!
hi number 8 from the first task!
hi number 9 from the first task!
</code></pre>
<p>Jak dotąd, wydaje się, że async i wątki dają nam podobne wyniki, tylko z
inną składnią: używając <code>await</code> zamiast wywoływania <code>join</code> na uchwycie <code>join</code>,
oraz oczekując na wywołania <code>sleep</code>.</p>
<p>Większą różnicą jest to, że nie musieliśmy tworzyć kolejnego wątku systemu
operacyjnego, aby to zrobić. W rzeczywistości, nie musimy nawet tworzyć tutaj
żadnego zadania. Ponieważ bloki async kompilują się do anonimowych futures,
możemy umieścić każdą pętlę w bloku async i pozwolić środowisku uruchomieniowemu
uruchomić je obie do końca za pomocą funkcji <code>trpl::join</code>.</p>
<p>W sekcji <a href="ch16-01-threads.html#waiting-for-all-threads-to-finish">„Czekanie na zakończenie wszystkich wątków”</a><!-- ignore
--> w Rozdziale 16 pokazaliśmy, jak używać metody <code>join</code> na typie
<code>JoinHandle</code> zwracanym po wywołaniu <code>std::thread::spawn</code>. Funkcja <code>trpl::join</code>
jest podobna, ale dla futures. Kiedy podasz jej dwie futures, produkuje jedną
nową future, której wynikiem jest krotka zawierająca wyniki każdej future,
którą przekazałeś, gdy <em>obie</em> zakończą działanie. Tak więc, w Listingu 17-8
używamy <code>trpl::join</code>, aby poczekać na zakończenie zarówno <code>fut1</code>, jak i <code>fut2</code>.
Nie oczekujemy na <code>fut1</code> i <code>fut2</code>, ale zamiast tego na nową future
produkowaną przez <code>trpl::join</code>. Ignorujemy wynik, ponieważ jest to tylko krotka
zawierająca dwie wartości jednostkowe.</p>
<listing number="17-8" caption="Użycie `trpl::join` do oczekiwania na dwie anonimowe futures" file-name="src/main.rs">
<pre class="playground"><code class="language-rust edition2024"><span class="boring">extern crate trpl; // required for mdbook test
</span><span class="boring">
</span><span class="boring">use std::time::Duration;
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    trpl::block_on(async {
</span>        let fut1 = async {
            for i in 1..10 {
                println!("hi number {i} from the first task!");
                trpl::sleep(Duration::from_millis(500)).await;
            }
        };

        let fut2 = async {
            for i in 1..5 {
                println!("hi number {i} from the second task!");
                trpl::sleep(Duration::from_millis(500)).await;
            }
        };

        trpl::join(fut1, fut2).await;
<span class="boring">    });
</span><span class="boring">}</span></code></pre>
</listing>
<p>Po uruchomieniu widzimy, że obie futures działają do końca:</p>
<!-- Not extracting output because changes to this output aren't significant;
the changes are likely to be due to the threads running differently rather than
changes in the compiler -->
<pre><code class="language-text">hi number 1 from the first task!
hi number 1 from the second task!
hi number 2 from the first task!
hi number 2 from the second task!
hi number 3 from the first task!
hi number 3 from the second task!
hi number 4 from the first task!
hi number 4 from the second task!
hi number 5 from the first task!
hi number 6 from the first task!
hi number 7 from the first task!
hi number 8 from the first task!
hi number 9 from the first task!
</code></pre>
<p>Teraz zobaczysz dokładnie tę samą kolejność za każdym razem, co jest bardzo
różne od tego, co widzieliśmy w przypadku wątków i <code>trpl::spawn_task</code> w Listingu
17-7. Dzieje się tak, ponieważ funkcja <code>trpl::join</code> jest <em>sprawiedliwa</em>,
oznacza to, że sprawdza każdą future tak samo często, naprzemiennie między nimi,
i nigdy nie pozwala jednej wyprzedzić drugiej, jeśli ta druga jest gotowa.
W przypadku wątków, system operacyjny decyduje, który wątek sprawdzić i jak
długo pozwolić mu działać. W przypadku async Rust, środowisko uruchomieniowe
decyduje, które zadanie sprawdzić. (W praktyce, szczegóły stają się
skomplikowane, ponieważ środowisko uruchomieniowe async może wykorzystywać
wątki systemu operacyjnego pod maską jako część sposobu zarządzania
współbieżnością, więc zagwarantowanie sprawiedliwości może być bardziej
pracochłonne dla środowiska uruchomieniowego – ale nadal jest to możliwe!)
Środowiska uruchomieniowe nie muszą gwarantować sprawiedliwości dla żadnej
danej operacji i często oferują różne API, aby umożliwić wybór, czy chcesz
sprawiedliwości, czy nie.</p>
<p>Wypróbuj niektóre z tych wariacji oczekiwania na futures i zobacz, co robią:</p>
<ul>
<li>Usuń blok async wokół jednej lub obu pętli.</li>
<li>Oczekuj na każdy blok async natychmiast po jego zdefiniowaniu.</li>
<li>Opakuj tylko pierwszą pętlę w blok async i oczekuj na wynikową future po
ciele drugiej pętli.</li>
</ul>
<p>Dodatkowym wyzwaniem jest sprawdzenie, czy potrafisz przewidzieć, jaki będzie
wynik w każdym przypadku <em>przed</em> uruchomieniem kodu!</p>
<!-- Old headings. Do not remove or links may break. -->
<p><a id="message-passing"></a>
<a id="counting-up-on-two-tasks-using-message-passing"></a></p>
<h3 id="przesyłanie-danych-między-dwoma-zadaniami-za-pomocą-przekazywania-wiadomości"><a class="header" href="#przesyłanie-danych-między-dwoma-zadaniami-za-pomocą-przekazywania-wiadomości">Przesyłanie danych między dwoma zadaniami za pomocą przekazywania wiadomości</a></h3>
<p>Współdzielenie danych między futures również będzie znajome: ponownie użyjemy
przekazywania wiadomości, ale tym razem z asynchronicznymi wersjami typów i
funkcji. Obierzemy nieco inną ścieżkę niż w sekcji <a href="ch16-02-message-passing.html">„Przesyłanie danych między
wątkami za pomocą przekazywania wiadomości”</a><!--
ignore --> w Rozdziale 16, aby zilustrować niektóre kluczowe różnice między
współbieżnością opartą na wątkach a współbieżnością opartą na futures. W Listingu
17-9 zaczniemy od pojedynczego bloku async – <em>nie</em> uruchamiając oddzielnego
zadania, tak jak uruchomiliśmy oddzielny wątek.</p>
<listing number="17-9" caption="Tworzenie kanału asynchronicznego i przypisywanie dwóch połówek do `tx` i `rx`" file-name="src/main.rs">
<pre class="playground"><code class="language-rust edition2024"><span class="boring">extern crate trpl; // required for mdbook test
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    trpl::block_on(async {
</span>        let (tx, mut rx) = trpl::channel();

        let val = String::from("hi");
        tx.send(val).unwrap();

        let received = rx.recv().await.unwrap();
        println!("received '{received}'");
<span class="boring">    });
</span><span class="boring">}</span></code></pre>
</listing>
<p>Tutaj używamy <code>trpl::channel</code>, asynchronicznej wersji API kanału typu
wiele-producentów, jeden-konsument, którego użyliśmy z wątkami w Rozdziale 16.
Asynchroniczna wersja API różni się tylko nieco od wersji opartej na wątkach:
używa mutowalnego, a nie niemutowalnego odbiornika <code>rx</code>, a jego metoda <code>recv</code>
produkuje future, na którą musimy czekać, zamiast bezpośrednio produkować
wartość. Teraz możemy wysyłać wiadomości z nadawcy do odbiornika. Zauważ, że
nie musimy uruchamiać oddzielnego wątku ani nawet zadania; wystarczy, że
będziemy czekać na wywołanie <code>rx.recv</code>.</p>
<p>Synchroniczna metoda <code>Receiver::recv</code> w <code>std::mpsc::channel</code> blokuje do czasu
otrzymania wiadomości. Metoda <code>trpl::Receiver::recv</code> tego nie robi, ponieważ
jest asynchroniczna. Zamiast blokować, przekazuje kontrolę z powrotem do
środowiska uruchomieniowego, dopóki nie zostanie odebrana wiadomość lub strona
wysyłająca kanału nie zostanie zamknięta. Natomiast nie czekamy na wywołanie
<code>send</code>, ponieważ nie blokuje. Nie musi, ponieważ kanał, do którego wysyłamy,
jest nieograniczony.</p>
<blockquote>
<p>Uwaga: Ponieważ cały ten kod async działa w bloku async w wywołaniu
<code>trpl::block_on</code>, wszystko w nim może uniknąć blokowania. Jednak kod <em>poza</em>
im blokiem będzie blokował, dopóki funkcja <code>block_on</code> nie zwróci wartości. Na
tym polega cała idea funkcji <code>trpl::block_on</code>: pozwala <em>wybrać</em>, gdzie
zablokować na jakimś zestawie kodu async, a tym samym, gdzie przejść między
kodem synchronicznym a asynchronicznym.</p>
</blockquote>
<p>Zauważ dwie rzeczy dotyczące tego przykładu. Po pierwsze, wiadomość dotrze
natychmiast. Po drugie, choć używamy tutaj przyszłości, nie ma jeszcze
współbieżności. Wszystko w listingu dzieje się sekwencyjnie, tak jakby nie było
żadnych futures.</p>
<p>Zajmijmy się pierwszą częścią, wysyłając serię wiadomości i pauzując między
nimi, jak pokazano w Listingu 17-10.</p>
<!-- We cannot test this one because it never stops! -->
<listing number="17-10" caption="Wysyłanie i odbieranie wielu wiadomości przez kanał asynchroniczny i pauzowanie z `await` między każdą wiadomością" file-name="src/main.rs">
<pre><code class="language-rust ignore"><span class="boring">extern crate trpl; // required for mdbook test
</span><span class="boring">
</span><span class="boring">use std::time::Duration;
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    trpl::block_on(async {
</span>        let (tx, mut rx) = trpl::channel();

        let vals = vec![
            String::from("hi"),
            String::from("from"),
            String::from("the"),
            String::from("future"),
        ];

        for val in vals {
            tx.send(val).unwrap();
            trpl::sleep(Duration::from_millis(500)).await;
        }

        while let Some(value) = rx.recv().await {
            println!("received '{value}'");
        }
<span class="boring">    });
</span><span class="boring">}</span></code></pre>
</listing>
<p>Oprócz wysyłania wiadomości, musimy je odbierać. W tym przypadku, ponieważ
wiemy, ile wiadomości nadejdzie, moglibyśmy to zrobić ręcznie, wywołując
<code>rx.recv().await</code> cztery razy. Jednak w prawdziwym świecie zazwyczaj będziemy
czekać na <em>nieznaną</em> liczbę wiadomości, więc musimy czekać, aż ustalimy, że
nie ma już więcej wiadomości.</p>
<p>W Listingu 16-10 użyliśmy pętli <code>for</code> do przetwarzania wszystkich elementów
otrzymanych z kanału synchronicznego. Rust nie ma jeszcze sposobu na użycie
pętli <code>for</code> z asynchronicznie produkowanym strumieniem elementów, więc musimy
użyć pętli, której wcześniej nie widzieliśmy: warunkowej pętli <code>while let</code>.
Jest to wersja pętli konstrukcji <code>if let</code>, którą widzieliśmy w sekcji <a href="ch06-03-if-let.html">„Zwięzła
kontrola przepływu z <code>if let</code> i <code>let...else</code>”</a><!-- ignore --> w
Rozdziale 6. Pętla będzie wykonywać się tak długo, jak długo określony wzorzec
będzie pasował do wartości.</p>
<p>Wywołanie <code>rx.recv</code> produkuje future, na którą czekamy. Środowisko uruchomieniowe
wstrzyma future, dopóki nie będzie gotowa. Gdy tylko nadejdzie wiadomość,
future rozstrzygnie się na <code>Some(message)</code> tyle razy, ile wiadomości nadejdzie.
Gdy kanał zostanie zamknięty, niezależnie od tego, czy <em>jakiekolwiek</em> wiadomości
nadeszły, future zamiast tego rozstrzygnie się na <code>None</code>, aby wskazać, że nie
ma już więcej wartości i w związku z tym powinniśmy przestać odpytywać – to
znaczy, przestać oczekiwać.</p>
<p>Pętla <code>while let</code> łączy to wszystko w całość. Jeśli wynik wywołania
<code>rx.recv().await</code> to <code>Some(message)</code>, uzyskujemy dostęp do wiadomości i możemy
jej używać w ciele pętli, tak jak w przypadku <code>if let</code>. Jeśli wynik to <code>None</code>,
pętla się kończy. Za każdym razem, gdy pętla się kończy, ponownie trafia na
punkt oczekiwania, więc środowisko uruchomieniowe ponownie ją wstrzymuje,
dopóki nie nadejdzie kolejna wiadomość.</p>
<p>Kod teraz pomyślnie wysyła i odbiera wszystkie wiadomości. Niestety, nadal
istnieją dwa problemy. Po pierwsze, wiadomości nie docierają w odstępach
półsekundowych. Docierają wszystkie naraz, 2 sekundy (2000 milisekund) po
uruchomieniu programu. Po drugie, ten program również nigdy się nie kończy!
Zamiast tego czeka w nieskończoność na nowe wiadomości. Musisz go wyłączyć,
używając <kbd>ctrl</kbd>-<kbd>C</kbd>.</p>
<h4 id="kod-w-jednym-bloku-async-wykonuje-się-liniowo"><a class="header" href="#kod-w-jednym-bloku-async-wykonuje-się-liniowo">Kod w jednym bloku Async wykonuje się liniowo</a></h4>
<p>Zacznijmy od zbadania, dlaczego wiadomości przychodzą wszystkie naraz po pełnym
opóźnieniu, zamiast przychodzić z opóźnieniami między każdą z nich. W danym
bloku async kolejność, w jakiej słowa kluczowe <code>await</code> pojawiają się w kodzie,
jest również kolejnością, w jakiej są wykonywane, gdy program działa.</p>
<p>W Listingu 17-10 jest tylko jeden blok async, więc wszystko w nim działa
liniowo. Nadal nie ma współbieżności. Wszystkie wywołania <code>tx.send</code> odbywają się,
przeplatane wszystkimi wywołaniami <code>trpl::sleep</code> i ich powiązanymi punktami
oczekiwania. Dopiero wtedy pętla <code>while let</code> może przejść przez którykolwiek z
punktów oczekiwania na wywołania <code>recv</code>.</p>
<p>Aby uzyskać pożądane zachowanie, w którym opóźnienie snu następuje między
każdą wiadomością, musimy umieścić operacje <code>tx</code> i <code>rx</code> w ich własnych blokach
async, jak pokazano w Listingu 17-11. Wtedy środowisko uruchomieniowe może
wykonać każdą z nich oddzielnie, używając funkcji <code>trpl::join</code>, podobnie jak
w Listingu 17-8. Ponownie, czekamy na wynik wywołania <code>trpl::join</code>, a nie na
poszczególne futures. Gdybyśmy czekali na poszczególne futures w sekwencji,
skutkowałoby to powrotem do sekwencyjnego przepływu – dokładnie tego, czego
próbujemy <em>nie</em> robić.</p>
<!-- We cannot test this one because it never stops! -->
<listing number="17-11" caption="Rozdzielenie `send` i `recv` na własne bloki `async` i oczekiwanie na futures dla tych bloków" file-name="src/main.rs">
<pre><code class="language-rust ignore"><span class="boring">extern crate trpl; // required for mdbook test
</span><span class="boring">
</span><span class="boring">use std::time::Duration;
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    trpl::block_on(async {
</span><span class="boring">        let (tx, mut rx) = trpl::channel();
</span><span class="boring">
</span>        let tx_fut = async {
            let vals = vec![
                String::from("hi"),
                String::from("from"),
                String::from("the"),
                String::from("future"),
            ];

            for val in vals {
                tx.send(val).unwrap();
                trpl::sleep(Duration::from_millis(500)).await;
            }
        };

        let rx_fut = async {
            while let Some(value) = rx.recv().await {
                println!("received '{value}'");
            }
        };

        trpl::join(tx_fut, rx_fut).await;
<span class="boring">    });
</span><span class="boring">}</span></code></pre>
</listing>
<p>Dzięki zaktualizowanemu kodowi z Listingu 17-11, wiadomości są drukowane w
odstępach 500 milisekund, a nie wszystkie naraz po 2 sekundach.</p>
<h4 id="przenoszenie-własności-do-bloku-async"><a class="header" href="#przenoszenie-własności-do-bloku-async">Przenoszenie własności do bloku <code>async</code></a></h4>
<p>Program nadal nigdy się nie kończy z powodu sposobu, w jaki pętla <code>while let</code>
współdziała z <code>trpl::join</code>:</p>
<ul>
<li>Future zwrócona przez <code>trpl::join</code> kończy się dopiero, gdy <em>obie</em> future,
które zostały do niej przekazane, zakończą swoje działanie.</li>
<li>Future <code>tx_fut</code> kończy się, gdy zakończy spanie po wysłaniu ostatniej
wiadomości w <code>vals</code>.</li>
<li>Future <code>rx_fut</code> nie zakończy się, dopóki pętla <code>while let</code> się nie zakończy.</li>
<li>Pętla <code>while let</code> nie zakończy się, dopóki oczekiwanie na <code>rx.recv</code> nie
zwróci <code>None</code>.</li>
<li>Oczekiwanie na <code>rx.recv</code> zwróci <code>None</code> dopiero po zamknięciu drugiego końca
kanału.</li>
<li>Kanał zostanie zamknięty tylko, jeśli wywołamy <code>rx.close</code> lub gdy strona
nadawcy, <code>tx</code>, zostanie usunięta.</li>
<li>Nigdzie nie wywołujemy <code>rx.close</code>, a <code>tx</code> nie zostanie usunięte, dopóki
najbardziej zewnętrzny blok async przekazany do <code>trpl::block_on</code> się nie
zakończy.</li>
<li>Blok nie może się zakończyć, ponieważ jest zablokowany przez zakończenie
<code>trpl::join</code>, co cofa nas na początek tej listy.</li>
</ul>
<p>Obecnie blok async, w którym wysyłamy wiadomości, jedynie <em>pożycza</em> <code>tx</code>,
ponieważ wysyłanie wiadomości nie wymaga własności, ale gdybyśmy mogli
<em>przenieść</em> <code>tx</code> do tego bloku async, zostałoby ono usunięte po zakończeniu
tego bloku. W sekcji <a href="ch13-01-closures.html#capturing-references-or-moving-ownership">„Przechwytywanie referencji lub przenoszenie
własności”</a><!-- ignore --> w Rozdziale 13 nauczyłeś się, jak
używać słowa kluczowego <code>move</code> z domknięciami, a jak omówiono w sekcji
<a href="ch16-01-threads.html#using-move-closures-with-threads">„Używanie domknięć <code>move</code> z wątkami”</a><!-- ignore --> w Rozdziale
16, często musimy przenosić dane do domknięć, pracując z wątkami. Te same
podstawowe dynamiki dotyczą bloków async, więc słowo kluczowe <code>move</code> działa z
blokami async tak samo, jak z domknięciami.</p>
<p>W Listingu 17-12 zmieniamy blok używany do wysyłania wiadomości z <code>async</code> na
<code>async move</code>.</p>
<listing number="17-12" caption="Poprawiona wersja kodu z Listingu 17-11, która poprawnie zamyka się po zakończeniu" file-name="src/main.rs">
<pre class="playground"><code class="language-rust edition2024"><span class="boring">extern crate trpl; // required for mdbook test
</span><span class="boring">
</span><span class="boring">use std::time::Duration;
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    trpl::block_on(async {
</span>        let (tx, mut rx) = trpl::channel();

        let tx_fut = async move {
            // --snip--
<span class="boring">            let vals = vec![
</span><span class="boring">                String::from("hi"),
</span><span class="boring">                String::from("from"),
</span><span class="boring">                String::from("the"),
</span><span class="boring">                String::from("future"),
</span><span class="boring">            ];
</span><span class="boring">
</span><span class="boring">            for val in vals {
</span><span class="boring">                tx.send(val).unwrap();
</span><span class="boring">                trpl::sleep(Duration::from_millis(500)).await;
</span><span class="boring">            }
</span><span class="boring">        };
</span><span class="boring">
</span><span class="boring">        let rx_fut = async {
</span><span class="boring">            while let Some(value) = rx.recv().await {
</span><span class="boring">                println!("received '{value}'");
</span><span class="boring">            }
</span><span class="boring">        };
</span><span class="boring">
</span><span class="boring">        trpl::join(tx_fut, rx_fut).await;
</span><span class="boring">    });
</span><span class="boring">}</span></code></pre>
</listing>
<p>Po uruchomieniu <em>tej</em> wersji kodu, zamyka się ona płynnie po wysłaniu i
odebraniu ostatniej wiadomości. Następnie, zobaczmy, co musiałoby się zmienić,
aby wysyłać dane z więcej niż jednej future.</p>
<h4 id="łączenie-wielu-futures-za-pomocą-makra-join"><a class="header" href="#łączenie-wielu-futures-za-pomocą-makra-join">Łączenie wielu futures za pomocą makra <code>join!</code></a></h4>
<p>Ten kanał async jest również kanałem wieloproducentowym, więc możemy wywołać
<code>clone</code> na <code>tx</code>, jeśli chcemy wysyłać wiadomości z wielu futures, jak pokazano
w Listingu 17-13.</p>
<listing number="17-13" caption="Użycie wielu producentów z blokami `async`" file-name="src/main.rs">
<pre class="playground"><code class="language-rust edition2024"><span class="boring">extern crate trpl; // required for mdbook test
</span><span class="boring">
</span><span class="boring">use std::time::Duration;
</span><span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    trpl::block_on(async {
</span>        let (tx, mut rx) = trpl::channel();

        let tx1 = tx.clone();
        let tx1_fut = async move {
            let vals = vec![
                String::from("hi"),
                String::from("from"),
                String::from("the"),
                String::from("future"),
            ];

            for val in vals {
                tx1.send(val).unwrap();
                trpl::sleep(Duration::from_millis(500)).await;
            }
        };

        let rx_fut = async {
            while let Some(value) = rx.recv().await {
                println!("received '{value}'");
            }
        };

        let tx_fut = async move {
            let vals = vec![
                String::from("more"),
                String::from("messages"),
                String::from("for"),
                String::from("you"),
            ];

            for val in vals {
                tx.send(val).unwrap();
                trpl::sleep(Duration::from_millis(1500)).await;
            }
        };

        trpl::join!(tx1_fut, tx_fut, rx_fut);
<span class="boring">    });
</span><span class="boring">}</span></code></pre>
</listing>
<p>Najpierw klonujemy <code>tx</code>, tworząc <code>tx1</code> poza pierwszym blokiem async. Przenosimy
<code>tx1</code> do tego bloku, tak jak wcześniej z <code>tx</code>. Następnie, później, przenosimy
oryginalne <code>tx</code> do <em>nowego</em> bloku async, gdzie wysyłamy więcej wiadomości z
nieco wolniejszym opóźnieniem. Akurat umieszczamy ten nowy blok async po bloku
async do odbierania wiadomości, ale równie dobrze mógłby być przed nim. Kluczem
jest kolejność, w jakiej futures są oczekiwane, a nie w jakiej są tworzone.</p>
<p>Oba bloki async do wysyłania wiadomości muszą być blokami <code>async move</code>,
tak aby zarówno <code>tx</code>, jak i <code>tx1</code> zostały usunięte po zakończeniu tych bloków.
W przeciwnym razie wrócimy do tej samej nieskończonej pętli, w której zaczęliśmy.</p>
<p>Na koniec, przełączamy się z <code>trpl::join</code> na <code>trpl::join!</code>, aby obsłużyć
dodatkowe future: makro <code>join!</code> oczekuje na dowolną liczbę futures, gdzie
liczbę futures znamy w czasie kompilacji. O oczekiwaniu na kolekcję nieznanej
liczby futures będziemy rozmawiać później w tym rozdziale.</p>
<p>Teraz widzimy wszystkie wiadomości z obu futures wysyłających, a ponieważ
futures wysyłające używają nieco innych opóźnień po wysłaniu, wiadomości są
również odbierane w tych różnych odstępach czasu:</p>
<!-- Not extracting output because changes to this output aren't significant;
the changes are likely to be due to the threads running differently rather than
changes in the compiler -->
<pre><code class="language-text">received 'hi'
received 'more'
received 'from'
received 'the'
received 'messages'
received 'future'
received 'for'
received 'you'
</code></pre>
<p>Możesz zobaczyć wartości w innej kolejności, w zależności od twojego systemu.
To właśnie sprawia, że współbieżność jest interesująca, a także trudna. Jeśli
poeksperymentujesz z <code>thread::sleep</code>, nadając mu różne wartości w różnych
wątkach, każde uruchomienie będzie bardziej niedeterministyczne i za każdym
razem będzie generować inne dane wyjściowe.</p>
<p>Teraz, gdy przyjrzeliśmy się, jak działają kanały, spójrzmy na inną metodę
współbieżności.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="ch17-01-futures-and-syntax.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="ch17-03-more-futures.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="ch17-01-futures-and-syntax.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="ch17-03-more-futures.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->
        <script src="ferris-2317480c.js"></script>



    </div>
    </body>
</html>
